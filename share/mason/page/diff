<table class="revision-diff">
  <thead>
    <tr>
      <th class="rev1">Revision <% $rev1->revision_number() %></th>
      <th class="marker"></th>
      <th class="rev2">Revision <% $rev2->revision_number() %></th>
    </tr>
  </thead>
% for my $diff (@diff) {
  <tbody>
%   if ( $diff->[0] eq 'c' ) {
<& .word_diff, diff => $diff->[1] &>
%   } else {
<& .para_diff, diff => $diff &>
%   }
  </tbody>
% }
</table>

<%args>
$page
$rev1
$rev2
@diff
</%args>

<%def .word_diff>
    <tr class="diff-changed">
      <td>
% for my $diff (@diff) {
%   if ( $diff->[0] eq '-' || $diff->[0] eq 'c' ) {
        <del><% $diff->[1] %></del>
%   } elsif ( $diff->[0] eq 'u' ) {
        <% $diff->[1] %>
%   }
% }
      </td>
      <td class="marker">
        <span title="a paragraph was changed">*</span>
      </td>
      <td>
% for my $diff (@diff) {
%   if ( $diff->[0] eq '+' || $diff->[0] eq 'c' ) {
        <ins><% $diff->[2] %></ins>
%   } elsif ( $diff->[0] eq 'u' ) {
        <% $diff->[1] %>
%   }
% }
      </td>
    </tr>
<%args>
@diff
</%args>
</%def>

<%def .para_diff>
    <tr>
      <td class="<% $diff[0] eq q{-} ? 'diff-removed' : q{} %>">
        <% $diff[1] %>
      </td>
      <td class="marker">
% if ( $diff[0] ne 'u' ) {
        <span title="a paragraph was <% $diff[0] eq '-' ? 'removed' : 'added' %>"><% $diff[0] %></span>
% }
      </td>
      <td class="<% $diff[0] eq q{+} ? 'diff-added' : q{} %>">
        <% $diff[2] %>
      </td>
    </tr>
<%args>
@diff
</%args>
</%def>

<%method title>
<% $page->title() %> - Revision <% $rev1->revision_number() %> versus <% $rev2->revision_number() %>
<%args>
$page
$rev1
$rev2
</%args>
</%method>
