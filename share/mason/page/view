<div id="tags">
% if (@tags) {
  <ul>
%   for my $tag (@tags) {
    <li>
      <a href="<% $wiki->uri( view => 'tag/' . $tag->tag_id() ) %>"><% $tag->tag() %></a>
%     if ($can_edit) {
      <a href="<% $page->uri( view => 'tag/' . $tag->tag_id() ) %>"><sup>x</sup></a>
%     }
    </li>
%   }
  </ul>
% }

% if ($can_edit) {
  <form id="tags" action="<% $page->uri( view => 'tags' ) %>" method="post">
    <input type="text" name="tags" />
    <p>
      <% loc( 'Enter tags separated by commas ("Financial, Big Projects, Dogs")' ) %>
    </p>
    <input type="submit" value="<% loc('Add Tags') %>" />
  </form>
% }
</div>

% unless ($is_current_revision) {
<p>
  <a href="<% $page->uri() %>"><% loc('Back to current revision') %></a>
</p>
% }

<% $html | n %>

<div id="attribution">
% if ( $revision->revision_number() > 1 ) {
%   if ($is_current_revision) {
<% loc( 'Last edited by <a href="%html(%1)">%html(%2)</a> %on_datetime(%3).',
        $wiki->uri( view => 'user/' . $revision->user_id() ),
        $revision->user()->best_name(),
        $c->user->set_time_zone_for_dt( $revision->creation_datetime() ) ) | n %>
%   } else {
<% loc( 'This revision was created by <a href="%html(%1)">%html(%2)</a> %on_datetime(%3).',
        $revision->user()->uri(),
        $revision->user()->best_name(),
        $c->user->set_time_zone_for_dt( $revision->creation_datetime() ) ) | n %>
%   }
<br />
% }
<% loc( 'Page created by <a href="%html(%1)">%html(%2)</a> %on_datetime(%3).',
        $wiki->uri( view => 'user/' . $page->user_id() ),
        $page->user()->best_name(),
        $c->user->set_time_zone_for_dt( $revision->creation_datetime() ) ) | n %>
</div>

% if ( $c->request()->params()->{debug} ) {
<pre>
<% $revision->content() %>
</pre>
% }

% if ( $revision->revision_number() > 1 ) {
<div id="compare-to-previous">
  <a href="<% $page->uri( view => 'diff', query => { revision1 => $revision->revision_number() - 1, revision2 => $revision->revision_number() } ) %>"><% loc('Compare to previous revision') %></a>
</div>
% }

<%args>
$page
$revision
$wiki
$is_current_revision
$html
</%args>

<%init>
my @tags = $page->tags()->all();

my $can_edit =
    $c->user()->has_permission_in_wiki( wiki => $wiki, permission => Silki::Schema::Permission->Edit() );
</%init>

<%method title>
<% $page->title() %>
% unless ($is_current_revision) {
(<% loc( 'Revision %1 of %2', $revision->revision_number(), $page->most_recent_revision()->revision_number() ) %>)
% }
<%args>
$page
$revision
$is_current_revision
</%args>
</%method>
